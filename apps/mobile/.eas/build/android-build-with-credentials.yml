# this config is executed when running a build with `android-build-with-credentials` profile
# check the profile's configuration in eas.json to see what are the settings needed to execute it properly
# @see example - https://github.com/expo/eas-custom-builds-example/blob/main/.eas/build/android-build-with-credentials.yml

functions:
  get_channel_name:
    name: Get Channel Name
    outputs:
      - channel_name
    command: |
      set -x

      set-output channel_name "preview"

build:
  name: Android build without credentials as executed by eas/build command
  steps:
    - eas/checkout

    - get_channel_name:
        id: get_channel_name

    - eas/use_npm_token

    - eas/install_node_modules

    - eas/resolve_build_config

    - eas/prebuild

    # https://docs.expo.dev/eas-update/introduction/
    - eas/configure_eas_update:
        inputs:
          channel: ${ steps.get_channel_name.channel_name }

    - eas/inject_android_credentials

    # https://docs.expo.dev/build-reference/app-versions/#remote-version-source
    - eas/configure_android_version

    - eas/run_gradle

    - eas/find_and_upload_build_artifacts
